<!DOCTYPE html5>
<head> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.js" integrity="sha512-/1nVu72YEESEbcmhE/EvjH/RxTg62EKvYWLG3NdeZibTCuEtW5M4z3aypcvsoZw03FAopi94y04GhuqRU9p+CQ==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/trix/1.3.1/trix.css" integrity="sha512-CWdvnJD7uGtuypLLe5rLU3eUAkbzBR3Bm1SFPEaRfvXXI2v2H5Y0057EMTzNuGGRIznt8+128QIDQ8RqmHbAdg==" crossorigin="anonymous">

</head>
    <article>
        <form action="/items/createItem", method="POST"> 
            <input id="editor", value="Editor content goes here", type="hidden", name="content">
            <trix-editor input="editor"></trix-editor>
            <label for='tags'>Tags</label>
            <input type='text' name='tags'>
            <input type="Submit", value="Create">
        </form>
    </article>

    <script>
        // upload to object storage
        addEventListener('trix-attachment-add', (event) => {
            if (event.attachment.file) {
                const url = window.location.origin 

                const file = event.attachment.file 
                const filename = new Date().getTime() + '-' + file.name
                const filetype = file.type 

                let form = new FormData()
                form.append('file', file)
                form.append('filename', filename)

                fetch(url+'/items/attachment', {
                    method: "POST",
                    credentials: 'same-origin',
                    body: form
                })
                .then(res => res.json())
                .then(data => {
                    const objectStorageUrl = data.url 
                    event.attachment.setAttributes({'url': objectStorageUrl, href: objectStorageUrl + '?content-disposition=attachment'})
                })
                .catch(err => { console.log(err)} )

            }
        })

    </script>